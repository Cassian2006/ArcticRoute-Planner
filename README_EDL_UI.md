# EDL é£é™© UI é›†æˆæŒ‡å—

## å¿«é€Ÿå¼€å§‹

### å¯ç”¨ EDL é£é™©

1. æ‰“å¼€ Streamlit UIï¼š`streamlit run run_ui.py`
2. åœ¨å·¦ä¾§ Sidebar ä¸­æ‰¾åˆ°"é£é™©æƒé‡"éƒ¨åˆ†
3. å‹¾é€‰"å¯ç”¨ EDL é£é™©ï¼ˆè‹¥å¯ç”¨ï¼‰"
4. è°ƒæ•´"EDL é£é™©æƒé‡ w_edl"æ»‘æ¡ï¼ˆ0.0 - 10.0ï¼‰
5. ç‚¹å‡»"è§„åˆ’ä¸‰æ¡æ–¹æ¡ˆ"

### æŸ¥çœ‹ EDL é£é™©è´¡çŒ®

åœ¨"æˆæœ¬åˆ†è§£ï¼ˆbalanced æ–¹æ¡ˆï¼‰"éƒ¨åˆ†ï¼Œè¡¨æ ¼ä¸­ä¼šæ˜¾ç¤ºï¼š
- `ğŸ§  EDL é£é™©` - EDL é£é™©çš„æˆæœ¬è´¡çŒ®
- `æ€»è´¡çŒ®` - è¯¥é£é™©åˆ†é‡å¯¹æ€»æˆæœ¬çš„ç»å¯¹å€¼
- `å æ¯”` - è¯¥é£é™©åˆ†é‡å æ€»æˆæœ¬çš„ç™¾åˆ†æ¯”

---

## å·¥ä½œåŸç†

### æ•°æ®æµ

```
ç”¨æˆ·å¯ç”¨ EDL â†’ plan_three_routes() â†’ build_cost_from_real_env()
  â†“
run_edl_on_features() â†’ ç”Ÿæˆ risk_mean
  â†“
æˆæœ¬åœºæ·»åŠ  edl_risk ç»„ä»¶
  â†“
compute_route_cost_breakdown() â†’ è®¡ç®—è´¡çŒ®
  â†“
UI è¡¨æ ¼æ˜¾ç¤º
```

### æˆæœ¬å…¬å¼

```
æ€»æˆæœ¬ = åŸºç¡€è·ç¦» + æµ·å†°é£é™© + æ³¢æµªé£é™© + å†°çº§çº¦æŸ + EDL é£é™©
```

å…¶ä¸­ï¼š
```
EDL é£é™© = w_edl Ã— æœŸæœ›é£é™©åˆ†æ•°ï¼ˆ0..1ï¼‰
```

---

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šDemo æ¨¡å¼

- **è®¾ç½®**ï¼šæˆæœ¬æ¨¡å¼ = "æ¼”ç¤ºå†°å¸¦æˆæœ¬"
- **EDL çŠ¶æ€**ï¼šä¸å¯ç”¨ï¼ˆå³ä½¿å‹¾é€‰ä¹Ÿä¼šè¢«å¿½ç•¥ï¼‰
- **ç”¨é€”**ï¼šå¿«é€Ÿæ¼”ç¤ºï¼Œä¸ä¾èµ–çœŸå®æ•°æ®

### åœºæ™¯ 2ï¼šçœŸå®ç¯å¢ƒ + EDL

- **è®¾ç½®**ï¼šæˆæœ¬æ¨¡å¼ = "çœŸå® SIC æˆæœ¬ï¼ˆè‹¥å¯ç”¨ï¼‰"ï¼Œå¯ç”¨ EDL
- **å‰ç½®æ¡ä»¶**ï¼šéœ€è¦çœŸå®ç¯å¢ƒæ•°æ® + PyTorch
- **æ•ˆæœ**ï¼šè·¯çº¿è§„åˆ’è€ƒè™‘å¤šæ¨¡æ€é£é™©

### åœºæ™¯ 3ï¼šçœŸå®ç¯å¢ƒ + æ—  EDL

- **è®¾ç½®**ï¼šæˆæœ¬æ¨¡å¼ = "çœŸå® SIC æˆæœ¬ï¼ˆè‹¥å¯ç”¨ï¼‰"ï¼Œä¸å¯ç”¨ EDL
- **æ•ˆæœ**ï¼šä»…è€ƒè™‘ç‰©ç†é£é™©ï¼ˆå†°ã€æ³¢æµªã€å†°çº§çº¦æŸï¼‰

---

## å‚æ•°è¯´æ˜

### use_edlï¼ˆå¯ç”¨ EDL é£é™©ï¼‰

- **ç±»å‹**ï¼šå‹¾é€‰æ¡†
- **é»˜è®¤å€¼**ï¼šFalseï¼ˆç¦ç”¨ï¼‰
- **è¯´æ˜**ï¼šå¯ç”¨åŸºäº Evidential Deep Learning çš„å¤šæ¨¡æ€é£é™©è¯„ä¼°
- **å½±å“**ï¼šä»…åœ¨"çœŸå® SIC æˆæœ¬"æ¨¡å¼ä¸‹ç”Ÿæ•ˆ

### w_edlï¼ˆEDL é£é™©æƒé‡ï¼‰

- **ç±»å‹**ï¼šæ»‘æ¡ï¼ˆä»…åœ¨ use_edl=True æ—¶æ˜¾ç¤ºï¼‰
- **èŒƒå›´**ï¼š0.0 - 10.0
- **é»˜è®¤å€¼**ï¼š3.0
- **è¯´æ˜**ï¼šè°ƒèŠ‚ EDL é£é™©åœ¨æ€»æˆæœ¬ä¸­çš„å½±å“
- **å»ºè®®**ï¼š
  - 0.0 - 1.0ï¼šEDL é£é™©å½±å“è¾ƒå°
  - 1.0 - 5.0ï¼šæ¨èèŒƒå›´
  - 5.0 - 10.0ï¼šEDL é£é™©å½±å“è¾ƒå¤§

---

## é™çº§è¡Œä¸º

### æ—  PyTorch

- **è¡¨ç°**ï¼šEDL è¿”å›å ä½ç¬¦ï¼ˆé£é™©åˆ†æ•° = 0ï¼‰
- **ç»“æœ**ï¼šä¸æŠ¥é”™ï¼Œç³»ç»Ÿç»§ç»­è¿è¡Œ
- **æ—¥å¿—**ï¼š`[EDL] torch not available; using fallback constant risk.`

### æ— çœŸå®ç¯å¢ƒæ•°æ®

- **è¡¨ç°**ï¼šè‡ªåŠ¨å›é€€åˆ° demo å†°å¸¦æˆæœ¬
- **ç»“æœ**ï¼šEDL ä¸è¢«è°ƒç”¨
- **æç¤º**ï¼šMeta ä¸­ `real_env_available = False`

### EDL å¼‚å¸¸

- **è¡¨ç°**ï¼šæ•è·å¼‚å¸¸ï¼Œç»§ç»­ä½¿ç”¨ä¸å« EDL çš„æˆæœ¬
- **ç»“æœ**ï¼šä¸æŠ¥é”™
- **æ—¥å¿—**ï¼š`[COST] warning: EDL risk computation failed: ...`

---

## å¸¸è§é—®é¢˜

### Q1ï¼šä¸ºä»€ä¹ˆå¯ç”¨ EDL åæˆæœ¬åˆ†è§£ä¸­æ²¡æœ‰ EDL é£é™©ï¼Ÿ

**A**ï¼šå¯èƒ½åŸå› ï¼š
1. ä½¿ç”¨çš„æ˜¯ Demo æ¨¡å¼ï¼ˆEDL ä»…åœ¨çœŸå®ç¯å¢ƒæ¨¡å¼ä¸‹ç”Ÿæ•ˆï¼‰
2. ç¼ºå°‘çœŸå®ç¯å¢ƒæ•°æ®ï¼ˆSIC æˆ–æ³¢æµªæ•°æ®ï¼‰
3. PyTorch ä¸å¯ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åˆ‡æ¢åˆ°"çœŸå® SIC æˆæœ¬ï¼ˆè‹¥å¯ç”¨ï¼‰"æ¨¡å¼
- ç¡®ä¿æœ‰çœŸå®ç¯å¢ƒæ•°æ®å¯ç”¨
- å®‰è£… PyTorchï¼š`pip install torch`

### Q2ï¼šEDL æƒé‡åº”è¯¥è®¾ç½®å¤šå°‘ï¼Ÿ

**A**ï¼šæ ¹æ®åº”ç”¨åœºæ™¯ï¼š
- **ä¿å®ˆ**ï¼ˆw_edl = 1.0ï¼‰ï¼šEDL é£é™©å½±å“è¾ƒå°ï¼Œä¸»è¦ä¾èµ–ç‰©ç†é£é™©
- **å¹³è¡¡**ï¼ˆw_edl = 3.0ï¼‰ï¼šæ¨èå€¼ï¼Œç‰©ç†é£é™©å’Œ EDL é£é™©å‡è¡¡
- **æ¿€è¿›**ï¼ˆw_edl = 5.0+ï¼‰ï¼šEDL é£é™©å½±å“è¾ƒå¤§ï¼Œæ›´åŠ è°¨æ…

### Q3ï¼šEDL é£é™©å’Œå†°çº§çº¦æŸçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

**A**ï¼š
- **å†°çº§çº¦æŸ**ï¼šåŸºäºèˆ¹èˆ¶çš„ç‰©ç†èƒ½åŠ›ï¼Œç¡¬æ€§é™åˆ¶
  - è½¯é£é™©ï¼šå†°åšåœ¨å®‰å…¨èŒƒå›´å†…ä½†æ¥è¿‘ä¸Šé™
  - ç¡¬ç¦åŒºï¼šå†°åšè¶…è¿‡èˆ¹èˆ¶èƒ½åŠ›ï¼Œä¸å¯é€šè¡Œ
- **EDL é£é™©**ï¼šåŸºäºå¤šæ¨¡æ€ç‰¹å¾çš„æ¦‚ç‡æ€§é£é™©è¯„ä¼°
  - è€ƒè™‘å†°ã€æ³¢æµªã€çº¬åº¦ã€ç»åº¦ç­‰å¤šä¸ªå› ç´ 
  - æä¾›é£é™©åˆ†æ•°è€Œéç¡¬æ€§é™åˆ¶

### Q4ï¼šå¦‚ä½•éªŒè¯ EDL æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ

**A**ï¼š
1. å¯ç”¨ EDLï¼Œè®¾ç½® w_edl = 5.0ï¼ˆè¾ƒå¤§å€¼ï¼‰
2. è§„åˆ’è·¯çº¿ï¼ŒæŸ¥çœ‹æˆæœ¬åˆ†è§£è¡¨
3. åº”è¯¥çœ‹åˆ°"ğŸ§  EDL é£é™©"è¡Œï¼Œæ•°å€¼ > 0
4. ç¦ç”¨ EDL é‡æ–°è§„åˆ’ï¼Œå¯¹æ¯”æ€»æˆæœ¬ï¼ˆåº”è¯¥ä¸åŒï¼‰

---

## æŠ€æœ¯ç»†èŠ‚

### EDL ç‰¹å¾

EDL æ¨¡å‹ä½¿ç”¨ 5 ä¸ªç‰¹å¾ï¼š

1. **sic_norm**ï¼šæµ·å†°æµ“åº¦ï¼ˆ0..1ï¼‰
2. **wave_swh_norm**ï¼šæ³¢æµªæœ‰æ•ˆæ³¢é«˜ï¼ˆ0..1ï¼ŒåŸºå‡† 10mï¼‰
3. **ice_thickness_norm**ï¼šå†°åšï¼ˆ0..1ï¼ŒåŸºå‡† 2mï¼‰
4. **lat_norm**ï¼šçº¬åº¦ï¼ˆ0..1ï¼Œ60-85Â°Nï¼‰
5. **lon_norm**ï¼šç»åº¦ï¼ˆ0..1ï¼Œ-180-180Â°ï¼‰

### EDL è¾“å‡º

- **risk_mean**ï¼šæœŸæœ›é£é™©åˆ†æ•°ï¼ˆ0..1ï¼‰
- **uncertainty**ï¼šä¸ç¡®å®šæ€§ä¼°è®¡ï¼ˆâ‰¥ 0ï¼‰

### æˆæœ¬èåˆ

```python
edl_cost = w_edl * risk_mean
æ€»æˆæœ¬ += edl_cost
```

---

## ä»£ç ç¤ºä¾‹

### åœ¨ä»£ç ä¸­å¯ç”¨ EDL

```python
from arcticroute.ui.planner_minimal import plan_three_routes
from arcticroute.core.grid import make_demo_grid

grid, land_mask = make_demo_grid()

routes, cost_fields, meta = plan_three_routes(
    grid, land_mask,
    start_lat=66.0, start_lon=5.0,
    end_lat=78.0, end_lon=150.0,
    cost_mode="real_sic_if_available",
    use_edl=True,      # å¯ç”¨ EDL
    w_edl=3.0,         # æƒé‡ 3.0
)

# æŸ¥çœ‹ meta
print(meta["use_edl"])  # True
print(meta["w_edl"])    # 3.0
```

### æ£€æŸ¥æˆæœ¬åˆ†è§£ä¸­çš„ EDL é£é™©

```python
from arcticroute.core.analysis import compute_route_cost_breakdown

cost_field = cost_fields["balanced"]
breakdown = compute_route_cost_breakdown(grid, cost_field, routes[1].coords)

# æŸ¥çœ‹ EDL é£é™©è´¡çŒ®
if "edl_risk" in breakdown.component_totals:
    edl_contribution = breakdown.component_totals["edl_risk"]
    edl_fraction = breakdown.component_fractions["edl_risk"]
    print(f"EDL é£é™©è´¡çŒ®ï¼š{edl_contribution:.2f}ï¼ˆå æ¯” {edl_fraction:.2%}ï¼‰")
else:
    print("EDL é£é™©ä¸å¯ç”¨")
```

---

## æµ‹è¯•

### è¿è¡Œ EDL ç›¸å…³æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰ EDL æµ‹è¯•
pytest tests/test_cost_real_env_edl.py -v
pytest tests/test_edl_core.py -v

# è¿è¡Œå…¨éƒ¨æµ‹è¯•
pytest -v
```

### é¢„æœŸç»“æœ

```
107 passed, 1 warning in 3.97s
```

---

## åç»­è®¡åˆ’

### Phase 3ï¼ˆå»ºè®®ï¼‰

1. **æ¨¡å‹è®­ç»ƒ**ï¼šä½¿ç”¨çœŸå®èˆªçº¿æ•°æ®è®­ç»ƒ EDL æ¨¡å‹
2. **å‚æ•°ä¼˜åŒ–**ï¼šè°ƒæ•´ w_edl é»˜è®¤å€¼å’Œç‰¹å¾å½’ä¸€åŒ–
3. **UI å¢å¼º**ï¼šæ·»åŠ çƒ­åŠ›å›¾ã€æ²¿ç¨‹å‰–é¢ç­‰å¯è§†åŒ–
4. **ä¸ç¡®å®šæ€§æ˜¾ç¤º**ï¼šåœ¨æˆæœ¬åˆ†è§£ä¸­æ˜¾ç¤º EDL å¹³å‡ä¸ç¡®å®šæ€§

---

## ç›¸å…³æ–‡æ¡£

- `EDL_UI_INTEGRATION_REPORT.md` - è¯¦ç»†å®ç°æŠ¥å‘Š
- `IMPLEMENTATION_SUMMARY.md` - å®ç°æ€»ç»“
- `FINAL_REPORT.md` - æœ€ç»ˆæŠ¥å‘Š
- `EDL_INTEGRATION_REPORT.md` - Phase EDL-1 æŠ¥å‘Š

---

## EDL æ•°æ®é›†æ„å»ºé¢„è§ˆï¼ˆè½»é‡ï¼‰

- ä½¿ç”¨é»˜è®¤é…ç½®å’Œåœºæ™¯ï¼š`python -m scripts.edl_preview_dataset --scenario barents_to_chukchi --reuse`
- é…ç½®æ–‡ä»¶ï¼š`configs/edl_dataset.yaml`ï¼›è¾“å‡ºï¼š`data_real/edl/training/edl_dataset_<scenario>.parquet`
- é¢„è§ˆå†…å®¹ï¼šè¡Œ/åˆ—è®¡æ•°ã€æ­£è´Ÿæ ·æœ¬æ¯”ä¾‹åŠå…³é”®ç‰¹å¾çš„ min/max/meanï¼›`--reuse` ç›´æ¥è¯»å–ç°æœ‰ parquet

---

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. æœ¬æ–‡æ¡£çš„"å¸¸è§é—®é¢˜"éƒ¨åˆ†
2. è¯¦ç»†å®ç°æŠ¥å‘Šä¸­çš„"é™çº§æœºåˆ¶"éƒ¨åˆ†
3. è¿è¡Œæµ‹è¯•éªŒè¯ç³»ç»ŸçŠ¶æ€












