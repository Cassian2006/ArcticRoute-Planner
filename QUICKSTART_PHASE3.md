# Phase 3 快速开始指南

## 安装依赖

确保已安装所有必要的包：

```bash
pip install streamlit pydeck pandas numpy
```

## 运行 UI

在项目根目录执行：

```bash
streamlit run run_ui.py
```

浏览器会自动打开 `http://localhost:8501`

## 使用步骤

### 1. 设置起点和终点

在左侧 sidebar 中：
- **起点纬度**: 输入起点纬度（默认 66.0°）
- **起点经度**: 输入起点经度（默认 5.0°）
- **终点纬度**: 输入终点纬度（默认 78.0°）
- **终点经度**: 输入终点经度（默认 150.0°）

### 2. 配置寻路参数

- **允许对角线移动 (8 邻接)**: 勾选以启用对角线移动，取消勾选则仅使用 4 邻接
  - ✓ 8 邻接：路径更短，但可能更"斜"
  - ✗ 4 邻接：路径更"直"，但通常更长

### 3. 点击规划按钮

点击 **"规划三条方案"** 按钮，系统会自动规划三条路线：

- **efficient** (蓝色): 冰带权重 = 1.0
  - 最短路径，但可能穿过冰带区域
  - 适合对冰带风险容忍度高的场景

- **balanced** (橙色): 冰带权重 = 4.0
  - 平衡路径长度和冰带风险
  - 推荐的默认方案

- **safe** (红色): 冰带权重 = 8.0
  - 最长路径，最大程度避开冰带
  - 适合对冰带风险容忍度低的场景

### 4. 查看结果

#### 地图展示
- 三条路线以不同颜色在地图上展示
- 可以拖拽地图、缩放、旋转查看细节
- 鼠标悬停显示方案名称

#### 方案摘要表
显示每条方案的关键指标：
- **方案**: 方案名称
- **可达**: 是否能规划出路线
- **路径点数**: 路径包含的格点数
- **粗略距离_km**: 路径的总长度（公里）
- **冰带权重**: 该方案使用的冰带权重
- **允许对角线**: 是否启用了 8 邻接

#### 详细信息
点击方案名称可展开查看：
- 冰带权重和路径点数
- 粗略距离
- 起点和终点坐标
- 部分路径点列表

## 示例场景

### 场景 1: 快速通过（忽视冰带）
1. 设置起点: (66°N, 5°E)
2. 设置终点: (78°N, 150°E)
3. 勾选 "允许对角线移动"
4. 点击 "规划三条方案"
5. 查看 **efficient** 方案（蓝色），这是最短的路线

### 场景 2: 安全通过（避开冰带）
1. 设置起点: (66°N, 5°E)
2. 设置终点: (78°N, 150°E)
3. 勾选 "允许对角线移动"
4. 点击 "规划三条方案"
5. 查看 **safe** 方案（红色），这是最安全但最长的路线

### 场景 3: 对比 4 邻接 vs 8 邻接
1. 设置起点和终点
2. **第一次**: 勾选 "允许对角线移动"，点击规划
3. **第二次**: 取消勾选 "允许对角线移动"，点击规划
4. 比较两次的路径点数：4 邻接路径通常更长

## 常见问题

### Q: 为什么三条方案都不可达？
A: 这通常意味着起点或终点在陆地上，或者被陆地包围。尝试调整起终点坐标。

### Q: 为什么 balanced 和 safe 的路径相同？
A: 这可能是因为在这个特定的起终点组合中，避开冰带的最优路径是相同的。

### Q: 距离计算是否准确？
A: 当前使用 haversine 公式计算大圆距离，精度足够用于 demo 演示。真实应用中可能需要更精确的地球椭球体模型。

### Q: 为什么路径会穿过陆地？
A: 当前使用的是 demo 网格和 demo landmask（非真实海陆分布），所以在真实地图上看起来可能会压到陆地。这是已知的限制。

### Q: 如何导出路线？
A: 当前版本不支持直接导出，但可以从摘要表中复制坐标数据。

## 技术细节

### Demo 网格参数
- **纬度范围**: 65°N ~ 80°N
- **经度范围**: 0°E ~ 160°E
- **网格分辨率**: 40 × 80（约 0.375° × 2°）
- **陆地区域**: 最右侧 10 列（简化的陆地模型）

### 冰带定义
- **阈值**: 纬度 >= 75°N
- **权重**: 在基础成本 1.0 的基础上增加指定的权重
  - efficient: +1.0 → 总成本 2.0
  - balanced: +4.0 → 总成本 5.0
  - safe: +8.0 → 总成本 9.0

### 寻路算法
- **算法**: A* 路径规划
- **邻接方式**: 支持 4 邻接（十字形）和 8 邻接（含对角）
- **启发式**: 欧氏距离
- **步长**: 直线 = 1，对角线 = √2

## 下一步

- 集成真实的海陆分布数据
- 添加更多风险因素（冰厚、风浪等）
- 支持多个起终点
- 实时路线更新和交互编辑
- 导出功能（GeoJSON、CSV 等）

---

**提示**: 如果遇到任何问题，请检查控制台输出和浏览器开发者工具中的错误信息。













