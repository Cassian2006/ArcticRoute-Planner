# é€Ÿåº¦æŒ‡æ•°æ‹Ÿåˆ - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ¯ ç›®æ ‡
é€šè¿‡ AIS èˆªé€Ÿæ•°æ®æ‹Ÿåˆç¯å¢ƒé˜»åŠ›å‡½æ•°çš„å¹‚æŒ‡æ•° (p, q)

## ğŸ“‹ å¿«é€Ÿå‘½ä»¤

### 1ï¸âƒ£ è¿è¡Œæ‹Ÿåˆè„šæœ¬
```bash
# å¿«é€Ÿæ¼”ç¤ºï¼ˆåˆæˆæ•°æ®ï¼Œ~30ç§’ï¼‰
python -m scripts.fit_speed_exponents --ym 202412 --max_points 5000

# å®Œæ•´æ‹Ÿåˆï¼ˆçœŸå®æ•°æ®ï¼Œéœ€è¦ AIS åŸå§‹æ–‡ä»¶ï¼‰
python -m scripts.fit_speed_exponents --ym 202412 --max_points 200000 \
  --coarse_step 0.2 --fine_step 0.05
```

### 2ï¸âƒ£ è¿è¡Œå•å…ƒæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/test_fit_speed_exponents_synth.py -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_fit_speed_exponents_synth.py::TestGridSearchFitting::test_grid_search_recovery -v
```

### 3ï¸âƒ£ éªŒè¯å·¥ä½œæµç¨‹
```bash
python scripts/verify_speed_exponents_workflow.py
```

## ğŸ“ è¾“å‡ºæ–‡ä»¶

è¿è¡Œè„šæœ¬åä¼šç”Ÿæˆï¼š

```
reports/
â”œâ”€â”€ fitted_speed_exponents_202412.json    # æ‹Ÿåˆç»“æœï¼ˆå®Œæ•´ï¼‰
â””â”€â”€ fitted_speed_exponents_202412.csv     # æ‹Ÿåˆç»“æœï¼ˆè¡¨æ ¼ï¼‰
```

### JSON æ–‡ä»¶å†…å®¹ç¤ºä¾‹
```json
{
  "ym": "202412",
  "p_sic": 1.0,           // æµ·å†°æŒ‡æ•°
  "q_wave": 0.8,          // æµ·å†µæŒ‡æ•°
  "b0": -0.315,           // æ¨¡å‹æˆªè·
  "b1": -0.618,           // SIC ç³»æ•°
  "b2": -0.014,           // Wave ç³»æ•°
  "rmse_train": 0.381,    // è®­ç»ƒ RMSE
  "rmse_holdout": 0.388,  // éªŒè¯ RMSE
  "r2_holdout": -0.010,   // éªŒè¯ RÂ²
  "n_samples_used": 3000, // ä½¿ç”¨æ ·æœ¬æ•°
  "n_mmsi_used": 100,     // MMSI æ•°é‡
  "timestamp_utc": "2025-12-14T07:39:18.131585"
}
```

## ğŸ”§ åœ¨ä»£ç ä¸­ä½¿ç”¨æ‹Ÿåˆç»“æœ

### æ–¹å¼ 1: è‡ªåŠ¨è¯»å–æ‹Ÿåˆç»“æœ
```python
from arcticroute.core.cost import build_cost_from_real_env

# è‡ªåŠ¨æŸ¥æ‰¾ fitted_speed_exponents_202412.json
cost_field = build_cost_from_real_env(
    grid, land_mask, env,
    ym="202412"  # å…³é”®å‚æ•°ï¼
)

# æŸ¥çœ‹ä½¿ç”¨çš„æŒ‡æ•°
print(f"SIC æŒ‡æ•°: {cost_field.meta['sic_power_effective']}")
print(f"æ¥æº: {cost_field.meta['sic_power_source']}")  # "fitted" æˆ– "default"
```

### æ–¹å¼ 2: æ‰‹åŠ¨è¯»å–æ‹Ÿåˆç»“æœ
```python
from arcticroute.core.cost import load_fitted_exponents

p_sic, q_wave, source = load_fitted_exponents("202412")
print(f"p={p_sic}, q={q_wave}, source={source}")
```

### æ–¹å¼ 3: è·å–é»˜è®¤å€¼ï¼ˆå¸¦å›é€€ï¼‰
```python
from arcticroute.core.cost import get_default_exponents

# ä¼˜å…ˆä»æ‹Ÿåˆç»“æœè¯»å–ï¼Œç¼ºå¤±åˆ™ç”¨é»˜è®¤å€¼
p, q = get_default_exponents(ym="202412")
print(f"p={p}, q={q}")
```

## ğŸ“Š å‚æ•°è¯´æ˜

### æ‹Ÿåˆè„šæœ¬å‚æ•°
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--ym` | å¿…éœ€ | ç›®æ ‡æœˆä»½ (YYYYMM) |
| `--max_points` | 200000 | æœ€å¤§è¯»å–è®°å½•æ•° |
| `--holdout` | 0.2 | éªŒè¯é›†æ¯”ä¾‹ |
| `--p_min` | 0.8 | p æœç´¢ä¸‹ç•Œ |
| `--p_max` | 2.6 | p æœç´¢ä¸Šç•Œ |
| `--q_min` | 0.8 | q æœç´¢ä¸‹ç•Œ |
| `--q_max` | 3.0 | q æœç´¢ä¸Šç•Œ |
| `--coarse_step` | 0.2 | ç²—æœæ­¥é•¿ |
| `--fine_step` | 0.05 | ç»†æœæ­¥é•¿ |
| `--data_root` | è‡ªåŠ¨ | æ•°æ®æ ¹ç›®å½• |
| `--output_dir` | reports | è¾“å‡ºç›®å½• |

## ğŸ§ª æµ‹è¯•è¦†ç›–

| æµ‹è¯•ç±» | æµ‹è¯•æ•° | è¯´æ˜ |
|--------|--------|------|
| `TestSpeedRatioComputation` | 2 | é€Ÿåº¦æ¯”è®¡ç®— |
| `TestLinearModelFitting` | 1 | çº¿æ€§æ‹Ÿåˆ |
| `TestGridSearchFitting` | 2 | ç½‘æ ¼æœç´¢ |
| `TestEdgeCases` | 2 | è¾¹ç•Œæƒ…å†µ |
| **æ€»è®¡** | **7** | å…¨éƒ¨é€šè¿‡ âœ“ |

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜ 1: "AIS ç›®å½•ä¸å­˜åœ¨"
**åŸå› **: æ²¡æœ‰çœŸå® AIS åŸå§‹æ•°æ®  
**è§£å†³**: è„šæœ¬ä¼šè‡ªåŠ¨ä½¿ç”¨åˆæˆæ•°æ®æ¼”ç¤ºï¼Œç»§ç»­è¿è¡Œå³å¯

### é—®é¢˜ 2: "æ‹Ÿåˆç»“æœæ–‡ä»¶ä¸å­˜åœ¨"
**åŸå› **: è¿˜æ²¡æœ‰è¿è¡Œæ‹Ÿåˆè„šæœ¬  
**è§£å†³**: è¿è¡Œ `python -m scripts.fit_speed_exponents --ym 202412`

### é—®é¢˜ 3: "cost.py è¯»å–æ‹Ÿåˆç»“æœå¤±è´¥"
**åŸå› **: æ‹Ÿåˆç»“æœæ–‡ä»¶æ ¼å¼é”™è¯¯æˆ–è·¯å¾„ä¸å¯¹  
**è§£å†³**: æ£€æŸ¥ `reports/fitted_speed_exponents_202412.json` æ˜¯å¦å­˜åœ¨ä¸”æœ‰æ•ˆ

### é—®é¢˜ 4: "å•å…ƒæµ‹è¯•å¤±è´¥"
**åŸå› **: ä¾èµ–åº“ç‰ˆæœ¬ä¸åŒ¹é…  
**è§£å†³**: è¿è¡Œ `pip install -r requirements.txt`

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### æ‹Ÿåˆè„šæœ¬
- åˆæˆæ•°æ® (5000 æ¡): ~30 ç§’
- çœŸå®æ•°æ® (200000 æ¡): ~5-10 åˆ†é’Ÿï¼ˆå–å†³äºæœç´¢èŒƒå›´ï¼‰

### å•å…ƒæµ‹è¯•
- å…¨éƒ¨æµ‹è¯•: ~1 ç§’

### æˆæœ¬è®¡ç®—
- è¯»å–æ‹Ÿåˆç»“æœ: < 1 æ¯«ç§’
- åº”ç”¨æŒ‡æ•°: < 1 æ¯«ç§’

## ğŸ“ ç­”è¾©è¦ç‚¹

### æ ¸å¿ƒåˆ›æ–°
1. **å»èˆ¹å‹å¤„ç†** - æŒ‰ MMSI è®¡ç®— baselineï¼Œæ¶ˆé™¤èˆ¹å‹å½±å“
2. **ä¸¤é˜¶æ®µæœç´¢** - ç²—æœå®šä½ï¼Œç»†æœç²¾åŒ–ï¼Œé«˜æ•ˆä¸”å‡†ç¡®
3. **äº¤å‰éªŒè¯** - 80/20 åˆ†å‰²ï¼ŒRMSE å’Œ RÂ² è¯„ä¼°
4. **è‡ªåŠ¨å›é€€** - æ‹Ÿåˆç»“æœç¼ºå¤±æ—¶è‡ªåŠ¨ä½¿ç”¨é»˜è®¤å€¼

### æ•°æ®è´¨é‡
- æ”¯æŒå¤šç§ AIS æ ¼å¼ (JSON/JSONL/GeoJSON)
- è‡ªåŠ¨è¿‡æ»¤åè¡Œå’Œ NaN å€¼
- å®Œæ•´çš„æ•°æ®ç»Ÿè®¡å’Œå…ƒæ•°æ®

### å¯é‡å¤æ€§
- å›ºå®šéšæœºç§å­ç¡®ä¿ç»“æœå¯é‡å¤
- å®Œæ•´çš„å‚æ•°è®°å½•åœ¨è¾“å‡ºæ–‡ä»¶ä¸­
- å•å…ƒæµ‹è¯•éªŒè¯ç®—æ³•æ­£ç¡®æ€§

## ğŸ“š ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| `scripts/fit_speed_exponents.py` | ~700 | æ‹Ÿåˆè„šæœ¬ |
| `tests/test_fit_speed_exponents_synth.py` | ~300 | å•å…ƒæµ‹è¯• |
| `arcticroute/core/cost.py` | ä¿®æ”¹ | æˆæœ¬æ¨¡å—é›†æˆ |
| `CALIB_SPEED_EXP_COMPLETION_REPORT.md` | - | å®Œæ•´æŠ¥å‘Š |

## ğŸš€ ä¸‹ä¸€æ­¥

1. âœ… è¿è¡Œæ‹Ÿåˆè„šæœ¬ç”Ÿæˆç»“æœ
2. âœ… è¿è¡Œå•å…ƒæµ‹è¯•éªŒè¯ç®—æ³•
3. âœ… åœ¨æˆæœ¬è®¡ç®—ä¸­ä½¿ç”¨æ‹Ÿåˆç»“æœ
4. âœ… åœ¨ç­”è¾©ä¸­å±•ç¤ºå®Œæ•´å·¥ä½œæµç¨‹

---

**æœ€åæ›´æ–°**: 2025-12-14  
**çŠ¶æ€**: âœ… å®Œæˆ







